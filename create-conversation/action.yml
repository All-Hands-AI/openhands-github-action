name: OpenHands Create Conversation
description: Create an OpenHands conversation and return the conversation ID and URL
author: All Hands AI
branding:
  icon: message-square
  color: blue

inputs:
  prompt:
    description: "Prompt text or path to a prompt file"
    required: true
  repository:
    description: "Repo to pass to OpenHands (defaults to current repo)"
    required: false
    default: ""
  selected-branch:
    description: "Branch to pass to OpenHands"
    required: false
    default: ""
  base-url:
    description: "OpenHands API base URL"
    required: false
    default: "https://app.all-hands.dev"
  openhands-api-key:
    description: "OpenHands API key (use secrets.OPENHANDS_API_KEY)"
    required: true

outputs:
  conversation-id:
    description: "Created conversation ID"
    value: ${{ steps.create.outputs.conversation-id }}
  conversation-url:
    description: "URL to view the conversation in the web interface"
    value: ${{ steps.create.outputs.conversation-url }}
  status:
    description: "Initial conversation status"
    value: ${{ steps.create.outputs.status }}

runs:
  using: "composite"
  steps:
    - uses: actions/setup-python@v5
      with:
        python-version: "3.11"

    - name: Install deps
      shell: bash
      run: |
        python -m pip install --upgrade pip
        pip install requests

    - name: Create conversation
      id: create
      shell: bash
      env:
        OPENHANDS_API_KEY: ${{ inputs.openhands-api-key }}
        INPUT_PROMPT: ${{ inputs.prompt }}
        INPUT_REPOSITORY: ${{ inputs.repository }}
        INPUT_SELECTED_BRANCH: ${{ inputs.selected-branch }}
        INPUT_BASE_URL: ${{ inputs.base-url }}
      run: |
        python "$GITHUB_ACTION_PATH/create_conversation.py"